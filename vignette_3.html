<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Vignette_3</title>
    <link rel="stylesheet" href="css/main.css" />

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.js"></script>

  </head>
  <body>

        <!-- NAVHBAR -->

    <nav class="navbar navbar-light bg-light">
      <div class="d-flex justify-content-start">

        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#moreInfo" aria-expanded="false" aria-controls="collapseExample">
          &oplus;
          </button>

        <!-- Question here -->

        <span class="navbar-text">
          which stakeholder has an opinion to which claim?
          </span>
          </div>

        <!-- Previous/Next Links here -->

    <!--<a class="nav-link" href="#">Next Chapter</a>-->
    <div class="d-flex justify-content-end">

    <a class="nav-link " href="vignette_2.html">&lang;</a>
    <a class="nav-link" href="dashboard.html">&rang;</a>
    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#index" aria-expanded="false" aria-controls="collapseExample">
        {}
      </button>   
      </div>
  </nav>

        <!-- MoreInfo Content here -->
 
<div class="collapse" id="moreInfo">
  <div class="card card-body">
    AAA pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident.
  </div>
</div>
        <!-- Index Content here -->

<div class="collapse" id="index">
    <div class="card card-body">
      <p class="text-center" id="heading">With Compliments <br> to the Secretary General </p>

      <p class="text-right">last updated <br> 13.04.2020</p>
      <p class="text-center" id="sub-heading">visualising maritime claims  <br> at the UN in regards <br> of the continental shelf</p>

      <p class="text-left"></p>  
        </div>
  </div>  

          <!-- VIGNETTE CONTENT HERE -->

          <div id="my_dataviz"></div>

          <script>

            // modified from https://www.d3-graph-gallery.com/
            // set the dimensions and margins of the graph
            var margin = {top: 20, right: 30, bottom: 150, left: 50},
              width = 1500 - margin.left - margin.right,
              height = 860 - margin.top - margin.bottom;
            
            // append the svg object to the body of the page
            var svg = d3.select("#my_dataviz")
              .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");
            
          
            // Read dummy data
            d3.json("./data/stakeholder_globalnorth-vs-south.json", function( data) {
            
              // List of node names
              var allNodes = data.nodes.map(function(d){return d.name})



              // A linear scale to position the nodes on the X axis
              var x = d3.scalePoint()
                .range([0, width])
                .domain(allNodes)
                
                svg
                .append("g")
                .attr("transform", "translate(-5,668)")      // This controls the rotate position of the Axis
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,10)rotate(-90)")
                .style("text-anchor", "end")
                .style("font-size", 12)
                .style("fill", "white")
                
                              var text = d3.selectAll("text");
var bbox = text.node().getBBox();
var padding = 2;
var rect = self.svg.insert("rect", "text")
    .attr("x", bbox.x - padding)
    .attr("y", bbox.y - padding)
    .attr("width", bbox.width + (padding*2))
    .attr("height", bbox.height + (padding*2))
    .style("fill", "red");

              //Add the circle for the nodes
             var nodes = svg
               .selectAll("mynodes")
               .data(data.nodes)
               .enter()
               .append("circle")
                 .attr("cx", function(d){ return(x(d.name))})
                 .attr("cy", height-30)
                 .attr("r", 8)
                 .style("fill", "#fff")

                 

              // Add links between nodes. Here is the tricky part.
              // In my input data, links are provided between nodes -id-, NOT between node names.
              // So I have to do a link between this id and the name
              var idToNode = {};
              data.nodes.forEach(function (n) {
                idToNode[n.id] = n;
              });
              // Cool, now if I do idToNode["2"].name I've got the name of the node with id 2
                        
       
       // Add the links
              var links = svg
                .selectAll('mylinks')
                .data(data.links)
                .enter()
                .append('path')
                .attr('d', function (d) {
                  start = x(idToNode[d.source].name)    // X position of start node on the X axis
                  end = x(idToNode[d.target].name)      // X position of end node
                  return ['M', start, height-30,    // the arc starts at the coordinate x=start, y=height-30 (where the starting node is)
                    'A',                            // This means we're gonna build an elliptical arc
                    (start - end)/1.95, ',',    // Next 2 lines are the coordinates of the inflexion point. Height of this point is proportional with start - end distance
                    (start - end)/2, 0, 0, ',',
                    start < end ? 1 : 0, end, ',', height-30] // We always want the arc on top. So if end is before start, putting 0 here turn the arc upside down.
                    .join(' ');
                })
                .style("fill", "none")
                .attr("stroke", "#fdbe21")
                .attr("stroke-width",1)
            
                // Add the highlighting functionality
                nodes
                  .on('mouseover', function (d) {
                    // Highlight the nodes: every node is green except of him
                    nodes.style('fill', "#fff")
                    d3.select(this).style('fill', '#fdbe21')
                    // Highlight the connections
                    links
                      .style('stroke', function (link_d) { return link_d.source === d.id || link_d.target === d.id ? '#fdbe21' : '#fff';})
                      .style('stroke-width', function (link_d) { return link_d.source === d.id || link_d.target === d.id ? 5 : 0.3;})
                  })
                  .on('mouseout', function (d) {
                    nodes.style('fill', "#fff")
                    links
                      .style('stroke', '#fdbe21')
                      .style('stroke-width', '1')
                  })
            })

             




            svg
            .append('text')
            .attr("text-anchor", "left")
            .style("fill", "#B8B8B8")
            .style("font-size", "17px")
            .attr("x", 278)
            .attr("y", 10)
            .html("Global South")

            svg
            .append('text')
            .attr("text-anchor", "right")
            .style("fill", "#B8B8B8")
            .style("font-size", "17px")
            .attr("x", 105)
            .attr("y", 10)
            .html("Global North")

            svg
            .append('line')
            .attr("x1", 253.57)
            .attr("x2", 253.57)
            .attr("y1", 0)
            .attr("y2", 668)
            .attr("stroke", "white")  
            .attr("stroke-width", 16) 
            
            </script>
    

  </body>
</html>